<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/core-image/core-image.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/core-image/core-image.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// import Locale from '../helpers/mixins/locale';
import {on, off, getScrollContainer, isInContainer} from '../../element-helpers/utils/dom';
import {isString, isHtmlElement} from '../../element-helpers/utils/types';
import {throttle} from 'throttle-debounce';
// import templateString from './element-image.html';
// import styleString from '../styles/index.scss';
import styleString from './core-image.scss';

// create template element
// const template = document.createElement('template');
// template.innerHTML = templateString;
// const template = document.createElement('template');

// create style element
const style = document.createElement('style');
style.innerHTML = styleString;

const isSupportObjectFit = () => document.documentElement.style.objectFit !== undefined;
const ObjectFit = {
  NONE: 'none',
  CONTAIN: 'contain',
  COVER: 'cover',
  FILL: 'fill',
  SCALE_DOWN: 'scale-down',
};

/**
 * &lt;element-image> component
 */
export default class CoreImage extends HTMLElement {
  /**
   * constructor
   */
  constructor() {
    super();

    this._src = this.getAttribute('src') || undefined;
    this._fit = this.getAttribute('fit') || undefined;
    this._lazy = this.hasAttribute('lazy') || false;

    this._loading = true;
    this._error = false;

    this._show = !this._lazy;
    this._imageWidth = 0;
    this._imageHeight = 0;
    this._scrollContainer = {};
    this._isServer = !(typeof window != 'undefined' &amp;&amp; window.document);

    this._template = document.createElement('template');
    this.attachShadow({mode: 'open'});
    this._updateTemplate();
  }

  /**
   * connectedCallback
   */
  connectedCallback() {
    if (this.lazy) {
      this._addLazyLoadListener();
    } else {
      this._loadImage();
    }
  }

  /**
   * disconnectedCallback
   */
  disconnectedCallback() {
    this.lazy &amp;&amp; this._removeLazyLoadListener();
  }

  /**
   * src getter
   */
  get src() {
    return this._src;
  }

  /**
   * src setter
   * @param {String} val
   */
  set src(val) {
    if (typeof val === 'string') {
      this._src = val;
      this.setAttribute('src', val);
    } else {
      this._src = undefined;
      this.removeAttribute('src');
    }

    this._updateTemplate();
    this._show &amp;&amp; this._loadImage();
  }

  /**
   * fit getter
   */
  get fit() {
    return this._fit;
  }

  /**
   * fit setter
   * @param {String} val
   */
  set fit(val) {
    if (['fill', 'contain', 'cover', 'none', 'scale-down'].indexOf(val) > -1) {
      this._fit = val;
      this.setAttribute('fit', val);
    } else {
      this._fit = undefined;
      this.removeAttribute('fit');
    }

    this._updateTemplate();
  }

  /**
   * lazy getter
   */
  get lazy() {
    return this._lazy;
  }

  /**
   * lazy setter
   * @param {Boolean} val
   */
  set lazy(val) {
    if (val === true) {
      this._lazy = true;
      this.setAttribute('lazy', '');
    } else {
      this._lazy = false;
      this.removeAttribute('lazy');
    }
  }

  /**
   * loading getter
   * @return {*}
   */
  get loading() {
    return this._loading;
  }

  /**
   * loading setter
   * @param {*} val
   */
  set loading(val) {
    this._loading = val;
  }

  /**
   * error getter
   * @return {*}
  */
  get error() {
    return this._error;
  }

  /**
   * error setter
   * @param {*} val
   */
  set error(val) {
    this._error = val;
  }

  /**
   * imageStyle getter
   */
  get imageStyle() {
    if (!this._isServer &amp;&amp; this.fit) {
      if (isSupportObjectFit()) {
        return `object-fit:${this.fit}`;
      } else {
        const _imageStyle = this._getImageStyle(this.fit);
        return _imageStyle.substr(1, _imageStyle.length - 2);
      }
    }
    return '';
  }

  /**
   * alignCenter getter
   */
  get alignCenter() {
    return !this._isServer &amp;&amp; !isSupportObjectFit() &amp;&amp; this.fit !== ObjectFit.FILL;
  }

  /**
   * loadTemplate
   */
  _updateTemplate() {
    let templateString;
    if (this.loading) {
      templateString = `
        &lt;slot name="placeholder">
          &lt;div class="el-image__placeholder">&lt;/div>
        &lt;/slot>
      `;
    } else if (this.error) {
      templateString = `
        &lt;slot name="error">
          &lt;div class="el-image__error">&lt;/div>
        &lt;/slot>
      `;
    } else {
      let classAttr;
      if (this.alignCenter) {
        classAttr = `class="el-image__inner--center"`;
      } else {
        classAttr = '';
      }

      let imageStyleAttr;
      if (this.imageStyle !== {}) {
        imageStyleAttr = `style=${this.imageStyle}`;
      } else {
        imageStyleAttr = '';
      }

      templateString = `
        &lt;img
          class="el-image__inner"
          src=${this.src}
          ${imageStyleAttr}
          ${classAttr}>
      `;
    }

    this._template.innerHTML = templateString;
    this.shadowRoot.innerHTML = '';
    this.shadowRoot.appendChild(this._template.content);
    this.shadowRoot.appendChild(style.cloneNode(true));
  }

  /**
   * loadImage()
   */
  _loadImage() {
    if (this._isServer) return;
    // reset status
    this.loading = true;
    this.error = false;
    const img = new Image();
    img.onload = (e) => this._handleLoad(e, img);
    img.onerror = this._handleError.bind(this);
    // If no src specified, an error appears in the console (this is the expected behavior)

    img.src = this.src;
  }

  /**
   * handleLoad()
   * @param {*} e
   * @param {*} img
   */
  _handleLoad(e, img) {
    this.imageWidth = img.width;
    this.imageHeight = img.height;
    this.loading = false;
    this._updateTemplate();
  }

  /**
   * handleError()
   * @param {*} e
   */
  _handleError(e) {
    this.loading = false;
    this.error = true;
    this._updateTemplate();
    // this.$emit('error', e);
  }

  /**
   * handleLazyLoad()
   */
  _handleLazyLoad() {
    if (isInContainer(this, this._scrollContainer)) {
      this.show = true;
      this._loadImage();
      this._removeLazyLoadListener();
    }
  }

  /**
   * addLazyLoadListener()
   */
  _addLazyLoadListener() {
    if (this._isServer) return;
    const {scrollContainer} = this;
    let _scrollContainer = null;
    if (isHtmlElement(scrollContainer)) {
      _scrollContainer = scrollContainer;
    } else if (isString(scrollContainer)) {
      _scrollContainer = document.querySelector(scrollContainer);
    } else {
      _scrollContainer = getScrollContainer(this);
    }
    if (_scrollContainer) {
      this._scrollContainer = _scrollContainer;
      this._lazyLoadHandler = throttle(500, this._handleLazyLoad.bind(this));
      on(_scrollContainer, 'scroll', this._lazyLoadHandler);
      this._handleLazyLoad();
    }
  }

  /**
   * removeLazyLoadListener()
   */
  _removeLazyLoadListener() {
    const {_scrollContainer, _lazyLoadHandler} = this;
    if (this._isServer || !_scrollContainer || !_lazyLoadHandler) return;
    off(_scrollContainer, 'scroll', _lazyLoadHandler);
    this._scrollContainer = null;
    this._lazyLoadHandler = null;
  }

  /**
   * simulate object-fit behavior to compatible with IE11 and other browsers which not support object-fit
   * @param {*} fit
   * @return {*}
   */
  _getImageStyle(fit) {
    // const {_imageWidth, _imageHeight} = this;
    const {
      clientWidth: containerWidth,
      clientHeight: containerHeight,
    } = this;
    if (!imageWidth || !imageHeight || !containerWidth || !containerHeight) return {};
    const vertical = imageWidth / imageHeight &lt; 1;
    if (fit === ObjectFit.SCALE_DOWN) {
      const isSmaller = imageWidth &lt; containerWidth &amp;&amp; imageHeight &lt; containerHeight;
      fit = isSmaller ? ObjectFit.NONE : ObjectFit.CONTAIN;
    }
    switch (fit) {
      case ObjectFit.NONE:
        return {width: 'auto', height: 'auto'};
      case ObjectFit.CONTAIN:
        return vertical ? {width: 'auto'} : {height: 'auto'};
      case ObjectFit.COVER:
        return vertical ? {height: 'auto'} : {width: 'auto'};
      default:
        return {};
    }
  }
}

if (!customElements.get('core-image')) {
  customElements.define('core-image', CoreImage);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Popper.modifiers.html">modifiers</a></li></ul><h3>Classes</h3><ul><li><a href="aria.html">aria</a></li><li><a href="CoreButton.html">CoreButton</a></li><li><a href="CoreHello.html">CoreHello</a></li><li><a href="coreModal.html">coreModal</a></li><li><a href="coreSlider.html">coreSlider</a></li><li><a href="fecha.html">fecha</a></li><li><a href="module.html#.exports">exports</a></li><li><a href="Popper.html">Popper</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_addLazyLoadListener">_addLazyLoadListener</a></li><li><a href="global.html#_getImageStyle">_getImageStyle</a></li><li><a href="global.html#_handleError">_handleError</a></li><li><a href="global.html#_handleLazyLoad">_handleLazyLoad</a></li><li><a href="global.html#_handleLoad">_handleLoad</a></li><li><a href="global.html#_loadImage">_loadImage</a></li><li><a href="global.html#_removeLazyLoadListener">_removeLazyLoadListener</a></li><li><a href="global.html#_updateTemplate">_updateTemplate</a></li><li><a href="global.html#alignCenter">alignCenter</a></li><li><a href="global.html#color">color</a></li><li><a href="global.html#connectedCallback">connectedCallback</a></li><li><a href="global.html#content">content</a></li><li><a href="global.html#attributeChangedCallback">attributeChangedCallback</a></li><li><a href="global.html#barStyle">barStyle</a></li><li><a href="global.html#circlePathStyle">circlePathStyle</a></li><li><a href="global.html#disconnectedCallback">disconnectedCallback</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#fit">fit</a></li><li><a href="global.html#hidden">hidden</a></li><li><a href="global.html#iconClass">iconClass</a></li><li><a href="global.html#imageStyle">imageStyle</a></li><li><a href="global.html#isDot">isDot</a></li><li><a href="global.html#lazy">lazy</a></li><li><a href="global.html#loading">loading</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#observedAttributes">observedAttributes</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#percentage">percentage</a></li><li><a href="global.html#perimeter">perimeter</a></li><li><a href="global.html#progressTextSize">progressTextSize</a></li><li><a href="global.html#relativeStrokeWidth">relativeStrokeWidth</a></li><li><a href="global.html#showText">showText</a></li><li><a href="global.html#src">src</a></li><li><a href="global.html#status">status</a></li><li><a href="global.html#stroke">stroke</a></li><li><a href="global.html#strokeWidth">strokeWidth</a></li><li><a href="global.html#textInside">textInside</a></li><li><a href="global.html#trackPath">trackPath</a></li><li><a href="global.html#type">type</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#width">width</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.1</a> on Tue Jun 11 2019 23:33:31 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
